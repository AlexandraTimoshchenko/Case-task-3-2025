{% extends "base.html" %}

{% block title %}{{ post.title }}{% endblock %}

{% block content %}
<div class="post">
  <h1>{{ post.title }}</h1>
  <div class="meta">
    Автор: <a href="#">{{ post.author.username }}</a> |
    Дата: {{ post.date_posted.strftime('%d.%m.%Y') }} |
    Теги:
    {% for tag in post.tags.split(',') if tag %}
    <a href="{{ url_for('posts_by_tag', tag=tag.strip()) }}">{{ tag.strip() }}</a>
    {% endfor %}
  </div>

  <div class="content">
    {{ post.content }}
  </div>

  {% if current_user == post.author %}
  <div class="actions">
    <a href="{{ url_for('edit_post', post_id=post.id) }}">Редактировать</a>
    <form action="{{ url_for('delete_post', post_id=post.id) }}" method="post" style="display:inline;">
      <button type="submit">Удалить</button>
    </form>
  </div>
  {% endif %}
</div>

<h2>Комментарии</h2>

{% if current_user.is_authenticated %}
<form method="POST" action="{{ url_for('add_comment', post_id=post.id) }}">
  <textarea name="content" rows="3" required></textarea>
  <button type="submit">Добавить комментарий</button>
</form>
{% endif %}

{% for comment in post.comments %}
<div class="comment">
  <div class="meta">
    {{ comment.author.username }} | {{ comment.date_posted.strftime('%d.%m.%Y %H:%M') }}
  </div>
  <p>{{ comment.content }}</p>
</div>
{% endfor %}
{% endblock %}